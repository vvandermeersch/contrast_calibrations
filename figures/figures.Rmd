---
title: "figures"
author: "Victor Van der Meersch"
date: "2024-04-17"
output: pdf_document
---

```{r setup, include=FALSE}
wd <- "C:/Users/vandermeersch/Documents/CEFE/projects/contrast_calibrations"

knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE,
                      fig.path= paste0(wd, "/figures/files/"))
chunkhooks::hook_figure_unit("mm")

library(dplyr)
library(data.table)
library(ggplot2)
library(ggpattern)
library(gtools)
library(dplyr)
library(xml2)
library(latex2exp)
library(ggh4x)
library(ggbeeswarm)
library(cowplot)
library(terra)
library(tidyterra)
library(doFuture)
library(future.apply)
library(stringr)
library(tidyr)
library(ModelMetrics)

source(file.path(wd, "scripts", "functions", "read_mean_outputvalue.R"))

```

## Figure 1

```{r fig1, fig.height = 65, eval = FALSE}
reload_data_fig1 <- FALSE

source(file.path(wd, "figures", "scripts", "fig1", "boxplot_similarity.R"))
source(file.path(wd, "figures", "scripts", "fig1", "historical_maps.R"))

plot_grid(historical_maps, boxplot_similarity, rel_widths = c(0.7, 0.33), labels = c("", "c."), label_size = 10, vjust = 3)

```

## Figure 2

```{r fig2, fig.height = 100, eval = FALSE}
reload_data_fig2 <- FALSE

source(file.path(wd, "figures", "scripts", "fig2", "boxplot_dates.R"))

plot_grid(endodormancy, ecodormancy, maturation, senescence, labels = c("a.", "b.", "c.", "d."), label_size = 10, vjust = 1.5)


```

\newpage 

## Figure 4

```{r fig4, fig.height = 100, fig.width = 180, eval = FALSE}
reload_data_fig4 <- FALSE

source(file.path(wd, "figures", "scripts", "fig4", "load_pheno_data.R"))
source(file.path(wd, "figures", "scripts", "fig4", "leafout_RMSE.R"))
source(file.path(wd, "figures", "scripts", "fig4", "flowering_RMSE.R"))
source(file.path(wd, "figures", "scripts", "fig4", "maturation_RMSE.R"))
source(file.path(wd, "figures", "scripts", "fig4", "senescence_RMSE.R"))

plot_grid(leafout_rmse_boxplots,
          NULL,
          flowering_rmse_boxplots,
          maturation_rmse_boxplots,
          NULL,
          senescence_rmse_boxplots, 
          NULL, NULL, NULL,
          without_maturation_boxplot, 
          NULL,
          without_senescence_boxplot, 
          ncol = 3, 
          rel_heights = c(0.6, 0.6, -0.03, 0.3),
          rel_widths = c(1, -0.15, 1),
          align = "v", axis = "lr")

```

## Figure 5

```{r fig5, fig.height = 80, eval = FALSE}
reload_data_fig5 <- FALSE

source(file.path(wd, "figures", "scripts", "fig5", "barplot.R"))
source(file.path(wd, "figures", "scripts", "fig5", "parameter_boxplot.R"))


plot_grid(barplot, param_boxplot, labels = c("a.", "b."), label_size = 10)

```

## Figure 6

```{r fig6, fig.height = 65, eval = TRUE}
reload_data_fig6 <- FALSE

source(file.path(wd, "figures", "scripts", "fig6", "barplot.R"))

barplot_partial
```

## Figure 7 

```{r fig7, fig.height = 65, fig.width = 60, eval = TRUE}
reload_data_fig7 <- FALSE

species <- "fagus_sylvatica"
source(file.path(wd, "figures", "scripts", "fig7", "load_pheno_data.R"))
models <- c("expert",paste0("partial/relmax/subset",rep(1:2, each = 5),"_rep", 1:5))
stades <- c(86)
ncores <- 11
source(file.path(wd, "figures", "scripts", "fig7", "maturation_RMSE.R"))
plot_grid(maturation_rmse_boxplots, without_maturation_boxplot, 
          rel_heights = c(0.65,0.35), ncol = 1, align = "v", axis = "lr")

species <- "picea_abies"
source(file.path(wd, "figures", "scripts", "fig7", "load_pheno_data.R"))
models <- c("expert",paste0("partial/dgt_flo_mat/subset",rep(1, each = 5),"_rep", 1:5))
stades <- c(60:65)
ncores <- 6
source(file.path(wd, "figures", "scripts", "fig7", "flowering_RMSE.R"))
plot_grid(flowering_rmse_boxplots, without_flowering_boxplot, 
          rel_heights = c(0.65,0.35), ncol = 1, align = "v", axis = "lr")

species <- "betula_pendula"
source(file.path(wd, "figures", "scripts", "fig7", "load_pheno_data.R"))
models <- c("expert",paste0("partial/frost_flo_mat/subset",rep(1, each = 5),"_rep", 1:5))
stades <- c(60:65)
ncores <- 6
source(file.path(wd, "figures", "scripts", "fig7", "flowering_RMSE.R"))
plot_grid(flowering_rmse_boxplots, without_flowering_boxplot, 
          rel_heights = c(0.65,0.35), ncol = 1, align = "v", axis = "lr")

species <- "quercus_robur"
source(file.path(wd, "figures", "scripts", "fig7", "load_pheno_data.R"))
models <- c("expert",paste0("partial/subset",rep(1:2, each = 5),"_rep", 1:5))
stades <- c(86)
ncores <- 11
source(file.path(wd, "figures", "scripts", "fig7", "maturation_RMSE.R"))
plot_grid(maturation_rmse_boxplots, without_maturation_boxplot, 
          rel_heights = c(0.65,0.35), ncol = 1, align = "v", axis = "lr")



```

